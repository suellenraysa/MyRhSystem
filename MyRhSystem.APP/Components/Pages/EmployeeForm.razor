@using MyRhSystem.APP.Shared
@using MyRhSystem.Application.Employees
@using MyRhSystem.APP.Shared.Constants

@if (Details is not null)
{
	<div class="modal-backdrop2" @onclick="CancelAsync"></div>

	<div class="modal2" role="dialog" aria-modal="true" aria-labelledby="emp-form-title">
		<div class="modal2-header">
			<h6 id="emp-form-title" class="m-0">@Title</h6>
			<button type="button" class="btn btn-sm btn-outline-secondary" @onclick="CancelAsync">
				<i class="bi bi-x-lg"></i>
			</button>
		</div>

		<div class="modal2-body" style="max-height:70vh; overflow:auto">
			<EditForm Model="Details" OnValidSubmit="OnSubmit">
				<DataAnnotationsValidator />
				<ValidationSummary />

				<!-- Abas -->
				<ul class="nav nav-pills mb-3">
					<li class="nav-item"><button type="button" class="nav-link @(Tab == 0 ? "active" : "")" @onclick="@(() => SetTab(0))">Dados Pessoais</button></li>
					<li class="nav-item"><button type="button" class="nav-link @(Tab == 1 ? "active" : "")" @onclick="@(() => SetTab(1))">Documentos</button></li>
					<li class="nav-item"><button type="button" class="nav-link @(Tab == 2 ? "active" : "")" @onclick="@(() => SetTab(2))">Contrato</button></li>
					<li class="nav-item"><button type="button" class="nav-link @(Tab == 3 ? "active" : "")" @onclick="@(() => SetTab(3))">Endereço</button></li>
					<li class="nav-item"><button type="button" class="nav-link @(Tab == 4 ? "active" : "")" @onclick="@(() => SetTab(4))">Benefícios</button></li>
					<li class="nav-item"><button type="button" class="nav-link @(Tab == 5 ? "active" : "")" @onclick="@(() => SetTab(5))">Dependentes</button></li>
					<li class="nav-item"><button type="button" class="nav-link @(Tab == 6 ? "active" : "")" @onclick="@(() => SetTab(6))">Emergência</button></li>
				</ul>

				<!-- Conteúdo das abas (2 colunas) -->
				<div class="container-fluid px-0">
					@* ========== DADOS PESSOAIS ========== *@
					@if (Tab == 0)
					{
						<div class="row g-3">
							<div class="col-md-6">
								<label for="nome" class="form-label">Nome</label>
								<InputText id="nome" name="nome" class="form-control" placeholder="Nome"
										   @bind-Value="Details.Nome" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-6">
								<label for="sobrenome" class="form-label">Sobrenome</label>
								<InputText id="sobrenome" name="sobrenome" class="form-control" placeholder="Sobrenome"
										   @bind-Value="Details.Sobrenome" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-6">
								<label for="datanascimento" class="form-label">Data de Nascimento</label>
								<InputDate id="datanascimento" name="datanascimento" class="form-control" placeholder="Data de Nascimento"
										   @bind-Value="Details.DataNascimento" disabled="@IsViewOnly" />
							</div>

							<div class="col-md-6">
								<label for="email" class="form-label">E-mail</label>
								<InputText id="email" name="email" class="form-control" placeholder="E-mail"
										   @bind-Value="Details.Email" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-6">
								<label for="telefone" class="form-label">Telefone</label>
								<InputText id="telefone" name="telefone" class="form-control" placeholder="Telefone"
										   @bind-Value="Details.Telefone" disabled="@IsViewOnly" />
							</div>

							<div class="col-md-6">
								<label for="cargo" class="form-label">Cargo</label>
								<InputText id="cargo" name="cargo" class="form-control" placeholder="Cargo"
										   @bind-Value="Details.Cargo" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-6">
								<label for="departamento" class="form-label">Departamento</label>
								<InputText id="departamento" name="departamento" class="form-control" placeholder="Departamento"
										   @bind-Value="Details.Departamento" disabled="@IsViewOnly" />
							</div>

							<div class="col-md-6">
								<label for="funcao" class="form-label">Função</label>
								<InputText id="funcao" name="funcao" class="form-control" placeholder="Função"
										   @bind-Value="Details.Funcao" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-6">
								<label for="grau" class="form-label">Grau de Instrução</label>
								<InputSelect id="grau" name="grau" class="form-select" @bind-Value="Details.GrauInstrucao" disabled="@IsViewOnly">
									<option value="" selected disabled>Selecione</option>
									@foreach (var e in AppDefaults.EducationLevels)
									{
										<option value="@e">@e</option>
									}
								</InputSelect>
							</div>

							<div class="col-md-6">
								<label for="nomemae" class="form-label">Nome Mae</label>
								<InputText id="mae" name="mae" class="form-control" placeholder="Filiação (Mãe)"
										   @bind-Value="Details.NomeMae" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-6">
								<label for="nomepai" class="form-label">NomePai</label>
								<InputText id="pai" name="pai" class="form-control" placeholder="Filiação (Pai)"
										   @bind-Value="Details.NomePai" disabled="@IsViewOnly" />
							</div>

							<div class="col-12 col-md-4">
								<label for="status" class="form-label">Status</label>
								<select id="status" name="status" class="form-select" @bind="Details.Ativo" disabled="@IsViewOnly">
									<option value="true">Ativo</option>
									<option value="false">Inativo</option>
								</select>
							</div>
						</div>
					}

					@* ========== DOCUMENTOS ========== *@
					@if (Tab == 1)
					{
						<div class="row g-3">
							<div class="col-md-6">
								<label for="cpf" class="form-label">CPF</label>
								<InputText id="cpf" name="cpf" class="form-control" placeholder="CPF"
										   @bind-Value="Details.Cpf" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-6">
								<label for="rg" class="form-label">RG</label>
								<InputText id="rg" name="rg" class="form-control" placeholder="RG"
										   @bind-Value="Details.Rg" disabled="@IsViewOnly" />
							</div>

							<div class="col-md-6">
								<label for="orgao" class="form-label">Órgao Emissor</label>
								<InputText id="orgao" name="orgao" class="form-control" placeholder="Órgão Emissor"
										   @bind-Value="Details.OrgaoEmissor" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-6">
								<label for="rgemissao" class="form-label">Rg Emissão</label>
								<div class="input-group">
									<span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
									<InputDate id="rgemissao" name="rgemissao" class="form-control"
											   @bind-Value="Details.RgEmissao" @bind-Value:format="dd/MM/yyyy" disabled="@IsViewOnly" />
								</div>
							</div>

							<div class="col-md-6">
								<label for="titulo" class="form-label">Título Eleitor</label>
								<InputText id="titulo" name="titulo" class="form-control" placeholder="Título de Eleitor"
										   @bind-Value="Details.TituloEleitor" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-3">
								<label for="zona" class="form-label">Zona</label>
								<InputText id="zona" name="zona" class="form-control" placeholder="Zona"
										   @bind-Value="Details.Zona" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-3">
								<label for="sessao" class="form-label">Sessão</label>
								<InputText id="sessao" name="sessao" class="form-control" placeholder="Seção"
										   @bind-Value="Details.Sessao" disabled="@IsViewOnly" />
							</div>

							<div class="col-md-6">
								<label for="ctps" class="form-label">CTPS Número</label>
								<InputText id="ctps" name="ctps" class="form-control" placeholder="CTPS"
										   @bind-Value="Details.CtpsNumero" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-6">
								<label for="ctpsserie" class="form-label">CTPS Série</label>
								<InputText id="ctpsserie" name="ctpsserie" class="form-control" placeholder="Série"
										   @bind-Value="Details.CtpsSerie" disabled="@IsViewOnly" />
							</div>
						</div>
					}

					@* ========== CONTRATO ========== *@
					@if (Tab == 2)
					{
						<div class="row g-3">

							<div class="col-md-5">
								<label for="tipocontrato" class="form-label">Tipo de Contrato</label>
								<InputSelect id="tipocontrato" class="form-select"
											 @bind-Value="Details.TipoContrato" disabled="@IsViewOnly">
									<option value="">Selecione</option>
									@foreach (var t in AppDefaults.WorkRegime)
									{
										<option value="@t">@t</option>
									}
								</InputSelect>
							</div>

							<div class="col-md-3">
								<label for="jornada" class="form-label">Jornada (h/sem)</label>
								<InputNumber id="jornada" class="form-control"
											 @bind-Value="Details.JornadaHoras" disabled="@IsViewOnly" />
							</div>

							<div class="col-md-4">
								<label for="admissao" class="form-label">Data Admissão</label>
								<div class="input-group">
									<span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
									<InputDate id="admissao" class="form-control"
											   @bind-Value="Details.Admissao" @bind-Value:format="dd/MM/yyyy" disabled="@IsViewOnly" />
								</div>
							</div>
							@* <div class="time-group d-flex align-items-center me-md-4"> *@
								<div class="col-md-6">
									<label for="experiencia1" class="form-label">Experiência 1ª</label>
									<div class="input-group">
										<span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
										<InputDate id="experiencia1" class="form-control"
												   @bind-Value="Details.DataExperiencia" @bind-Value:format="dd/MM/yyyy" disabled="@IsViewOnly" />
									</div>
								</div>

								<div class="col-md-6">
									<label for="experiencia2" class="form-label">Experiência 2ª</label>
									<div class="input-group">
										<span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
										<InputDate id="experiencia2" class="form-control"
												   @bind-Value="Details.DataExperiencia1" @bind-Value:format="dd/MM/yyyy" disabled="@IsViewOnly" />
									</div>
								</div>
							@* </div> *@

							<div class="col-12">
								<div class="time-row d-flex flex-column flex-md-row align-items-center">

									<div class="time-group d-flex align-items-center me-md-4">
										<label for="entrada-hora" class="form-label mb-0 me-2">Entrada</label>

										<InputNumber id="entrada-hora"
													 @bind-Value="EntradaHora"
													 class="form-control time-input"
													 @onwheel:preventDefault @attributes="HourAttrs" />
										<span class="time-sep">:</span>
										<InputNumber id="entrada-min"
													 @bind-Value="EntradaMinuto"
													 class="form-control time-input"
													 @onwheel:preventDefault @attributes="MinuteAttrs" />
									</div>

									<div class="time-group d-flex align-items-center">
										<label for="saida-hora" class="form-label mb-0 me-2">Saída</label>

										<InputNumber id="saida-hora"
													 @bind-Value="SaidaHora"
													 class="form-control time-input"
													 @onwheel:preventDefault @attributes="HourAttrs" />
										<span class="time-sep">:</span>
										<InputNumber id="saida-min"
													 @bind-Value="SaidaMinuto"
													 class="form-control time-input"
													 @onwheel:preventDefault @attributes="MinuteAttrs" />
									</div>

								</div>
							</div>

						</div>
					}
					@* ========== ENDEREÇO ========== *@
					@if (Tab == 3)
					{
						<div class="row g-3">
							<div class="col-md-6">
								<label for="endereco" class="form-label">Endereço</label>
								<InputText id="endereco" name="endereco" class="form-control" placeholder="Endereço"
										   @bind-Value="Details.Endereco" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-3">
								<label for="numero" class="form-label">Número</label>
								<InputText id="numero" name="numero" class="form-control" placeholder="Número"
										   @bind-Value="Details.Numero" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-3">
								<label for="bairro" class="form-label">Bairro</label>
								<InputText id="bairro" name="bairro" class="form-control" placeholder="Bairro"
										   @bind-Value="Details.Bairro" disabled="@IsViewOnly" />
							</div>

							<div class="col-md-6">
								<label for="cidade" class="form-label">Cidade</label>
								<InputText id="cidade" name="cidade" class="form-control" placeholder="Cidade"
										   @bind-Value="Details.Cidade" disabled="@IsViewOnly" />
							</div>
							<div class="col-md-3">
								<label for="uf" class="form-label">UF</label>
								<InputSelect id="uf" name="uf" class="form-select" @bind-Value="Details.UF" disabled="@IsViewOnly">
									<option value="" selected disabled>Selecione</option>
									@foreach (var uf in AppDefaults.States)
									{
										<option value="@uf">@uf</option>
									}
								</InputSelect>
							</div>
							<div class="col-md-3">
								<label for="cep" class="form-label">CEP</label>
								<InputText id="cep" name="cep" class="form-control" placeholder="CEP"
										   @bind-Value="Details.Cep" disabled="@IsViewOnly" />
							</div>
						</div>
					}

					@* ========== BENEFÍCIOS ========== *@
					@if (Tab == 4)
					{
						<div class="row g-3">
							<div class="col-md-6 d-flex align-items-center gap-4">
								<div class="form-check">
									<input id="bvr" name="bvr" type="checkbox" class="form-check-input"
										   @bind="HasValeRefeicao" disabled="@IsViewOnly" />
									<label for="bvr" class="form-check-label">Vale Refeição</label>
								</div>
								<div class="form-check">
									<input id="bvt" name="bvt" type="checkbox" class="form-check-input"
										   @bind="HasValeTransporte" disabled="@IsViewOnly" />
									<label for="bvt" class="form-check-label">Vale Transporte</label>
								</div>
							</div>
							<div class="col-12">
								<small class="text-muted">Outros benefícios podem ser adicionados depois.</small>
							</div>
						</div>
					}

					@* ========== DEPENDENTES ========== *@
					@if (Tab == 5)
					{
						<div class="d-flex justify-content-between align-items-center mb-2">
							<h6 class="m-0">Dependentes</h6>
							@if (!IsViewOnly)
							{
								<button type="button" class="btn btn-sm btn-outline-primary" @onclick="AddDependente">+ Adicionar</button>
							}
						</div>

						@if (Details.Dependentes?.Any() == true)
						{
							@foreach (var d in Details.Dependentes)
							{
								<div class="row g-2 align-items-end mb-2">
									<div class="col-md-5">
										<InputText id="@($"dep-nome-{d.Id}")" name="@($"dep-nome-{d.Id}")" class="form-control" placeholder="Nome"
												   @bind-Value="d.Nome" disabled="@IsViewOnly" />
									</div>
									<div class="col-md-4">
										<InputDate id="@($"dep-nasc-{d.Id}")" name="@($"dep-nasc-{d.Id}")" class="form-control"
												   @bind-Value="d.Nascimento" disabled="@IsViewOnly" />
									</div>
									<div class="col-md-3">
										<InputText id="@($"dep-par-{d.Id}")" name="@($"dep-par-{d.Id}")" class="form-control" placeholder="Parentesco"
												   @bind-Value="d.GrauParentesco" disabled="@IsViewOnly" />
									</div>
									@if (!IsViewOnly)
									{
										<div class="col-12">
											<button type="button" class="btn btn-sm btn-outline-danger"
													@onclick="@(() => RemoveDependente(d.Id))">
												<i class="bi bi-trash"></i> Remover
											</button>
										</div>
									}
								</div>
							}
						}
						else
						{
							<div class="alert alert-light border">Nenhum dependente adicionado.</div>
						}
					}

					@* ========== EMERGÊNCIA ========== *@
					@if (Tab == 6)
					{
						<div class="d-flex justify-content-between align-items-center mb-2">
							<h6 class="m-0">Contatos</h6>
							@if (!IsViewOnly)
							{
								<button type="button" class="btn btn-sm btn-outline-primary" @onclick="AddContato">+ Adicionar</button>
							}
						</div>
						@if (Details.Contatos?.Any() == true)
						{
							@foreach (var c in Details.Contatos)
							{
								<div class="row g-2 align-items-end mb-2">
									<div class="col-md-4">
										<InputText id="emerg-nome" name="emerg-nome" class="form-control" placeholder="Nome"
												   @bind-Value="c.Nome" disabled="@IsViewOnly" />
									</div>
									<div class="col-md-4">
										<InputText id="emerg-par" name="emerg-par" class="form-control" placeholder="Parentesco"
												   @bind-Value="c.GrauParentesco" disabled="@IsViewOnly" />
									</div>
									<div class="col-md-4">
										<InputText id="emerg-tel" name="emerg-tel" class="form-control" placeholder="Telefone"
												   @bind-Value="c.Telefone" disabled="@IsViewOnly" />
									</div>
									@if (!IsViewOnly)
									{
										<div class="col-12">
											<button type="button" class="btn btn-sm btn-outline-danger"
													@onclick="@(() => RemoveContato(c.Id))">
												<i class="bi bi-trash"></i> Remover
											</button>
										</div>
									}
								</div>
							}
						}
						else
						{
							<div class="alert alert-light border">Nenhum contato adicionado.</div>
						}
					}
				</div>

				<div class="d-flex justify-content-end gap-2 mt-3">
					<button type="button" class="btn btn-light" @onclick="CancelAsync">Cancelar</button>
					@if (!IsViewOnly)
					{
						<button type="submit" class="btn btn-success">Salvar</button>
					}
				</div>
			</EditForm>
		</div>
	</div>
}
